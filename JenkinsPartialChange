def artifactname = "devops-snow-build-app.jar"
def repoName = "Demo"
def semanticVersion = "${env.BUILD_NUMBER}.0.0"
def packageName = "devops-snow-build-pkg_${env.BUILD_NUMBER}"
def version = "${env.BUILD_NUMBER}.0"
def pkgName = "devops-snow-build-pkg"

pipeline {
  agent any
  tools {
    maven 'Maven'
  }
  environment { 
	  SCANNER_HOME = tool 'sonarScanner'
	} 
  stages {
    stage('Build') {
      steps {
        echo 'In build stage'
        sh 'mvn -B -DskipTests clean compile'
        echo 'Build successful'
      }
    }
    stage('Test') { 
      steps {
        echo 'In Test stage'
        sh 'mvn test'
        echo 'Test successful'
      }
    }
    stage('Sonar') { 
      steps {
        echo 'In Sonar stage'
		withSonarQubeEnv('SonarCloud') {
			sh '${SCANNER_HOME}/bin/sonar-scanner -Dsonar.projectKey=riyapulusuganti_Demo -Dsonar.organization=riyapulusuganti -Dsonar.host.url=https://sonarcloud.io -Dsonar.login=1ff462f03228674e3a684569d716aad1aff286bb -Dsonar.java.binaries=target/ -Dsonar.branch.name=master'
		}
        echo 'Sonar successful'
      }
    }
    stage('Veracode') { 
      steps {
        echo 'In Veracode stage'
        echo 'Veracode successful'
      }
    }
    stage('Change') { 
      steps {
        echo 'In Change stage'
        snDevOpsChange(
          changeCreationTimeOut: 3600,
          changeStepTimeOut: 18000,
          pollingInterval: 60,
          changeRequestDetails: """
          {
              "attributes": {
                  "chg_model": {
                      "name": "DevOps"
                  },
                  "description": "Automated Software Deployment from Jenkins Pipeline",
                  "assignment_group": "a715cd759f2002002920bde8132e7018"
              }
          }
          """)
        echo 'Change successful'
      }
    }
  }
}
